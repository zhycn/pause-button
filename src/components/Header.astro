---
interface Props {
  locale: any;
  currentLang: string;
}

const { locale, currentLang } = Astro.props;
const supportedLangs = ['zh-CN', 'en'];
const otherLang = supportedLangs.find(lang => lang !== currentLang) || 'en';
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-gray-950/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
    <!-- Logo -->
    <div class="flex items-center">
      <a href="/" class="text-xl font-semibold text-gray-900 dark:text-gray-100 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
        {locale.ui.logo}
      </a>
    </div>

    <!-- Right side: GitHub, Language, Theme -->
    <div class="flex items-center gap-4">
      <!-- GitHub -->
      <a
        href={locale.footer.links.github}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
        aria-label={locale.ui.github}
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416 0-2.653.915-3.287 1.715-.188.315-.825 1.082-1.18 1.301-.405.216-.98.315-1.475-.303-.315-.315-.682-.915-.682-1.715 0-1.301.915-2.301 1.715-2.787-.188-.315-.682-1.582.188-3.287 1.301-.315 2.653.315 3.287.315.682.682 1.582.682 2.653v3.287c0 .315.188.688.793.577 4.769-1.582 8.207-6.085 8.207-11.387 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>

      <!-- Language Switcher -->
      <button
        id="lang-switcher"
        class="px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
        aria-label={locale.ui.language}
        data-current-lang={currentLang}
        data-other-lang={otherLang}
      >
        {currentLang === 'zh-CN' ? '中文' : 'English'}
      </button>

      <!-- Theme Switcher -->
      <button
        id="theme-switcher"
        class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
        aria-label={locale.ui.theme}
      >
        <!-- Sun icon (light mode) -->
        <svg id="sun-icon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18z"/>
        </svg>
        <!-- Moon icon (dark mode) -->
        <svg id="moon-icon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 0 1 8.646 3.646 9 9 0 1 0 18 9 9 0 0 1 15.354 20.354z"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<script>
  // Theme switcher
  const themeSwitcher = document.getElementById('theme-switcher');
  const sunIcon = document.getElementById('sun-icon');
  const moonIcon = document.getElementById('moon-icon');

  // Load saved theme or default to light
  const savedTheme = localStorage.getItem('theme') || 'light';
  if (savedTheme === 'dark') {
    document.documentElement.classList.add('dark');
  }

  themeSwitcher?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  });

  // Language switcher
  const langSwitcher = document.getElementById('lang-switcher');
  langSwitcher?.addEventListener('click', () => {
    const currentLang = langSwitcher.dataset.currentLang;
    const otherLang = langSwitcher.dataset.otherLang;
    
    // Reload with new language
    const url = new URL(window.location.href);
    url.searchParams.set('lang', otherLang);
    window.location.href = url.toString();
  });
</script>
