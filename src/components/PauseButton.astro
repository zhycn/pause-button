---
interface Props {
  locale: any;
}

const { locale } = Astro.props;
---

<button
  id="pause-btn"
  type="button"
  class="relative group px-8 py-6 rounded-full bg-black dark:bg-white text-white dark:text-black font-medium text-lg shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600 active:scale-95"
  aria-label={locale.ui.fallbackMessage}
  data-suggestions={JSON.stringify(locale.suggestions)}
>
  <span class="relative z-10">{locale.ui.buttonText}</span>
  <!-- Button hover effect -->
  <span class="absolute inset-0 rounded-full bg-gray-800 dark:bg-gray-200 opacity-0 group-hover:opacity-20 transition-opacity"></span>
</button>

<script>
  // Global event system for suggestion updates
  (function() {
    'use strict';
    
    // Get suggestions from JSON data attribute
    const suggestionsData = document.getElementById('pause-btn')?.getAttribute('data-suggestions');
    let suggestions = [];
    
    if (suggestionsData) {
      try {
        suggestions = JSON.parse(suggestionsData);
      } catch (e) {
        console.error('[PauseButton] Failed to parse suggestions:', e);
      }
    }
    
    // Ensure suggestions is available globally
    window.__pauseButtonSuggestions = suggestions;
    
    function initPauseButton() {
      const btn = document.getElementById('pause-btn');
      if (!btn) {
        console.error('[PauseButton] Button element not found');
        return;
      }

      const suggestions = window.__pauseButtonSuggestions;
      if (!Array.isArray(suggestions) || suggestions.length === 0) {
        console.error('[PauseButton] No suggestions available', suggestions);
        return;
      }

      function handleClick(e: Event) {
        e.preventDefault();
        e.stopPropagation();
        
        const randomIndex = Math.floor(Math.random() * suggestions.length);
        const randomSuggestion = suggestions[randomIndex];
        
        if (!randomSuggestion) {
          console.warn('[PauseButton] Invalid suggestion at index', randomIndex);
          return;
        }

        console.log('[PauseButton] Dispatching suggestion:', randomSuggestion);
        
        // Dispatch custom event to update hero text
        const event = new CustomEvent('suggestion-updated', {
          detail: { suggestion: randomSuggestion },
          bubbles: true,
          cancelable: false
        });
        
        const dispatched = document.dispatchEvent(event);
        console.log('[PauseButton] Event dispatched:', dispatched);
      }

      btn.addEventListener('click', handleClick);
      console.log('[PauseButton] Initialized successfully');
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPauseButton);
    } else {
      // DOM already ready, initialize immediately
      setTimeout(initPauseButton, 0);
    }
  })();
</script>
