---
import Header from '../components/Header.astro';
import HeroText from '../components/HeroText.astro';
import PauseButton from '../components/PauseButton.astro';
import CultureSection from '../components/CultureSection.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

// Language detection and loading
const supportedLocales = ['zh-CN', 'en'];

// Get language from URL param or browser preference
const urlParams = Astro.url.searchParams;
let userLang = urlParams.get('lang') || '';

// Default to 'en' if no lang param (browser detection happens client-side)
if (!userLang) {
  userLang = 'en';
}

// Load locale data
const localeData = await import(`../data/locales/${userLang}.json`);
const locale = localeData.default;
---

<html lang={userLang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pause Button Â· {locale.ui.logo}</title>
    <meta name="description" content={locale.ui.fallbackMessage} />
    <link rel="icon" href="data:," />
  </head>
  <body class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Header -->
    <Header locale={locale} currentLang={userLang} />

    <!-- Main Content -->
    <main class="pt-24 pb-12 min-h-screen flex flex-col">
      <!-- Hero Section -->
      <div class="flex-1 flex flex-col items-center justify-center px-6">
        <!-- Hero Text -->
        <HeroText locale={locale} />
        
        <!-- Pause Button -->
        <PauseButton locale={locale} />
      </div>

      <!-- Culture Section (only on large screens) -->
      <div class="hidden lg:block">
        <CultureSection locale={locale} />
      </div>
    </main>

    <!-- Footer -->
    <Footer locale={locale} />

    <!-- Client-side language detection -->
    <script>
      // Initialize theme on page load
      (function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();

      // Auto-detect language if no lang param
      (function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (!urlParams.has('lang')) {
          const browserLang = navigator.language || navigator.languages?.[0] || 'en';
          const supportedLocales = ['zh-CN', 'en'];
          const detectedLang = supportedLocales.find(lang => 
            browserLang === lang || browserLang.startsWith(lang.split('-')[0])
          ) || 'en';
          
          if (detectedLang !== 'en') { // Only redirect if not default
            const url = new URL(window.location.href);
            url.searchParams.set('lang', detectedLang);
            window.location.href = url.toString();
          }
        }
      })();
    </script>
  </body>
</html>
